# =============================================================================
# NestJS Backend - Environment Configuration
# =============================================================================
# This file is used when running NestJS standalone (not via docker-compose)
# For docker-compose, variables are set in docker-compose.yml or root .env
# =============================================================================

# -----------------------------------------------------------------------------
# DATABASE - Prisma + PostgreSQL
# -----------------------------------------------------------------------------
# Local Docker:
DATABASE_URL="postgresql://postgres:postgres@localhost:5433/app_db?schema=public"

# Supabase (use TRANSACTION POOLER - Prisma engine requirement):
# DATABASE_URL="postgresql://postgres.[PROJECT_REF]:[PASSWORD]@[POOLER_HOST]:6543/postgres?pgbouncer=true&connection_limit=20&schema=public"

# Prisma Migrations (Session Pooler or Direct - Transaction pooler not supported):
DIRECT_URL="postgresql://postgres:postgres@localhost:5433/app_db?schema=public"
# DIRECT_URL="postgresql://postgres.[PROJECT_REF]:[PASSWORD]@[POOLER_HOST]:5432/postgres?schema=public"

# -----------------------------------------------------------------------------
# AZURE OPENAI CONFIGURATION
# -----------------------------------------------------------------------------
AZURE_OPENAI_RESOURCE_NAME=your-resource-name
AZURE_OPENAI_API_KEY=your-azure-openai-api-key
AZURE_OPENAI_API_VERSION=2025-01-01-preview
AZURE_OPENAI_GPT4O_DEPLOYMENT_ID=gpt-4o
AZURE_OPENAI_GPT5_DEPLOYMENT_ID=gpt-5

# -----------------------------------------------------------------------------
# ALTERNATIVE LLM PROVIDERS
# -----------------------------------------------------------------------------
OPENAI_API_KEY=your-openai-api-key
ANTHROPIC_API_KEY=your-anthropic-api-key
OLLAMA_BASE_URL=http://localhost:11434/v1

# -----------------------------------------------------------------------------
# AUTHENTICATION
# -----------------------------------------------------------------------------
AUTH_TOKEN=changeme-use-strong-secret-in-production

# -----------------------------------------------------------------------------
# SERVER CONFIGURATION
# -----------------------------------------------------------------------------
PORT=3000
NODE_ENV=development

# -----------------------------------------------------------------------------
# SUPABASE CONNECTION GUIDE FOR NESTJS + PRISMA
# -----------------------------------------------------------------------------
# Prisma has a framework-specific requirement:
#
# 1. Use TRANSACTION POOLER (port 6543) for runtime queries
#    - Prisma engine REQUIRES Transaction mode PgBouncer
#    - Add ?pgbouncer=true to tell Prisma to adapt its query behavior
#    - Set connection_limit based on your compute tier (e.g., 20 for medium)
#
# 2. Use SESSION POOLER (port 5432) for migrations (DIRECT_URL)
#    - prisma migrate and prisma db push need direct/session connection
#    - Transaction pooler does NOT support schema operations
#
# 3. Prisma Connection Pool:
#    - Prisma maintains its own pool (like SQLAlchemy)
#    - Default: num_physical_cpus * 2 + 1
#    - Control via connection_limit query parameter
#
# 4. Connection String Formats:
#    Runtime (DATABASE_URL):
#      postgresql://postgres.[PROJECT_REF]:[PASSWORD]@[POOLER_HOST]:6543/postgres?pgbouncer=true&connection_limit=20&schema=public
#
#    Migrations (DIRECT_URL):
#      postgresql://postgres.[PROJECT_REF]:[PASSWORD]@[POOLER_HOST]:5432/postgres?schema=public
#
# WHY DIFFERENT FROM FASTAPI?
# - SQLAlchemy (FastAPI): Works with Session Pooler, no special requirements
# - Prisma (NestJS): Query engine requires Transaction mode, documented in Prisma docs
# - Both are persistent backends, but Prisma has a framework limitation
# -----------------------------------------------------------------------------
