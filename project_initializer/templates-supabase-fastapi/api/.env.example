# ============================================================================
# Supabase Database Configuration
# ============================================================================

# Session Mode Pooler (port 5432) - for FastAPI runtime queries
# This is a PERSISTENT backend, so we use Session Pooler.
# Format: postgresql://postgres.[PROJECT_REF]:[PASSWORD]@[POOLER_HOST]:5432/postgres?sslmode=require
#
# Example: postgresql://postgres.abcdefghijklmnop:your-password@aws-0-us-west-1.pooler.supabase.com:5432/postgres?sslmode=require
DATABASE_URL=postgresql://postgres.[PROJECT_REF]:[YOUR-PASSWORD]@[POOLER_HOST]:5432/postgres?sslmode=require

# Direct Connection - for Alembic migrations only
# Format: postgresql://postgres:[PASSWORD]@db.[PROJECT_REF].supabase.co:5432/postgres
#
# Example: postgresql://postgres:your-password@db.abcdefghijklmnop.supabase.co:5432/postgres
DIRECT_DATABASE_URL=postgresql://postgres:[YOUR-PASSWORD]@db.[PROJECT_REF].supabase.co:5432/postgres

# ============================================================================
# How to get these values from Supabase Dashboard:
# ============================================================================
# 1. Go to: Settings > Database
# 2. Under "Connection string", select "URI"
# 3. For DATABASE_URL: Use the "Session mode" connection string (port 5432)
#    - Click "Use connection pooling" → "Session mode"
#    - Copy the URI and replace [YOUR-PASSWORD] with your database password
# 4. For DIRECT_DATABASE_URL: Use the "Direct connection" string
#    - Uncheck "Use connection pooling"
#    - Copy the URI and replace [YOUR-PASSWORD] with your database password
#
# Note: [PROJECT_REF] is your project reference (e.g., abcdefghijklmnop)
#       [POOLER_HOST] is typically: aws-0-[region].pooler.supabase.com
# ============================================================================

# ============================================================================
# Supabase Auth Configuration
# ============================================================================

# Supabase Project URL
# Found in: Settings > API > Project URL
SUPABASE_URL=https://your-project.supabase.co

# Supabase Publishable Key (anon key)
# Found in: Settings > API > Project API keys > anon public
# This key is used client-side for authentication
SUPABASE_PUBLISHABLE_KEY=your-publishable-key

# Supabase Service Role Key (server-side only)
# Found in: Settings > API > Project API keys > service_role secret
# NEVER expose this key client-side! It bypasses Row Level Security (RLS)
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# ============================================================================
# Azure OpenAI Configuration (for chatbot)
# ============================================================================
AZURE_OPENAI_RESOURCE_NAME=your-resource-name
AZURE_OPENAI_GPT5_DEPLOYMENT_ID=your-deployment-id
AZURE_OPENAI_API_VERSION=2024-02-15-preview
AZURE_OPENAI_KEY=your-azure-openai-key

# ============================================================================
# Alternative: Anthropic API (if you want to use Claude instead)
# ============================================================================
ANTHROPIC_API_KEY=your-anthropic-api-key

# ============================================================================
# Alternative: OpenAI API (if you want to use OpenAI instead)
# ============================================================================
OPENAI_API_KEY=your-openai-api-key

# ============================================================================
# Optional: Ollama for local testing
# ============================================================================
OLLAMA_BASE_URL=http://localhost:11434/v1

# ============================================================================
# Application Configuration
# ============================================================================
ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=INFO

# ============================================================================
# Supabase Compute Tier & Pool Sizing Guide
# ============================================================================
# Your SQLAlchemy pool size should be MUCH SMALLER than Supabase's pool limit.
#
# Supabase Pool Limits (shared between Session & Transaction poolers):
# - Small tier:  ~90 connections  → Set DATABASE_POOL_SIZE=15, MAX_OVERFLOW=5
# - Medium tier: ~120 connections → Set DATABASE_POOL_SIZE=20, MAX_OVERFLOW=10
# - Large tier:  ~160 connections → Set DATABASE_POOL_SIZE=30, MAX_OVERFLOW=15
# - XL tier:     ~240 connections → Set DATABASE_POOL_SIZE=40, MAX_OVERFLOW=20
#
# For 1000+ concurrent users with persistent backend:
# - Users are served by backend's pool (e.g., 20 connections)
# - Each connection handles many requests sequentially
# - Supabase pool size is NOT users, it's backend connections
# - Medium tier (120 pool) is sufficient for most use cases
#
# Default settings (for Medium tier):
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=10
DATABASE_POOL_RECYCLE=300
# ============================================================================
