# =============================================================================
# NestJS + Supabase Backend - Environment Configuration
# =============================================================================

# -----------------------------------------------------------------------------
# DATABASE - Prisma + Supabase PostgreSQL
# -----------------------------------------------------------------------------

# Transaction Pooler (port 6543) - for Prisma runtime queries
# Prisma engine REQUIRES Transaction mode PgBouncer
# Format: postgresql://postgres.[PROJECT_REF]:[PASSWORD]@[POOLER_HOST]:6543/postgres?pgbouncer=true&connection_limit=20&sslmode=require&schema=public
DATABASE_URL="postgresql://postgres.[PROJECT_REF]:[YOUR-PASSWORD]@aws-1-eu-west-1.pooler.supabase.com:6543/postgres?pgbouncer=true&connection_limit=20&sslmode=require&schema=public"

# Session Pooler (port 5432) - for Prisma migrations
# prisma migrate and prisma db push need session/direct connection
# Format: postgresql://postgres.[PROJECT_REF]:[PASSWORD]@[POOLER_HOST]:5432/postgres?sslmode=require&schema=public
DIRECT_URL="postgresql://postgres.[PROJECT_REF]:[YOUR-PASSWORD]@aws-1-eu-west-1.pooler.supabase.com:5432/postgres?sslmode=require&schema=public"

# Local Docker (uncomment for local development):
# DATABASE_URL="postgresql://postgres:postgres@localhost:5433/app_db?schema=public"
# DIRECT_URL="postgresql://postgres:postgres@localhost:5433/app_db?schema=public"

# -----------------------------------------------------------------------------
# SUPABASE AUTH CONFIGURATION
# -----------------------------------------------------------------------------

# Supabase Project URL
# Found in: Settings > API > Project URL
SUPABASE_URL=https://your-project.supabase.co

# Supabase Publishable Key (anon key)
# Found in: Settings > API > Project API keys > anon public
# Used to initialize Supabase client for JWT verification
SUPABASE_PUBLISHABLE_KEY=your-publishable-key

# Supabase Service Role Key (server-side only)
# Found in: Settings > API > Project API keys > service_role secret
# NEVER expose this key client-side! It bypasses Row Level Security (RLS)
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# -----------------------------------------------------------------------------
# AZURE OPENAI CONFIGURATION
# -----------------------------------------------------------------------------
AZURE_OPENAI_RESOURCE_NAME=your-resource-name
AZURE_OPENAI_API_KEY=your-azure-openai-api-key
AZURE_OPENAI_API_VERSION=2025-01-01-preview
AZURE_OPENAI_GPT4O_DEPLOYMENT_ID=gpt-4o
AZURE_OPENAI_GPT5_DEPLOYMENT_ID=gpt-5

# -----------------------------------------------------------------------------
# ALTERNATIVE LLM PROVIDERS
# -----------------------------------------------------------------------------
OPENAI_API_KEY=your-openai-api-key
ANTHROPIC_API_KEY=your-anthropic-api-key
OLLAMA_BASE_URL=http://localhost:11434/v1

# -----------------------------------------------------------------------------
# SERVER CONFIGURATION
# -----------------------------------------------------------------------------
PORT=3000
NODE_ENV=development

# -----------------------------------------------------------------------------
# SUPABASE CONNECTION GUIDE FOR NESTJS + PRISMA
# -----------------------------------------------------------------------------
# Prisma has a framework-specific requirement:
#
# 1. Use TRANSACTION POOLER (port 6543) for runtime queries
#    - Prisma engine REQUIRES Transaction mode PgBouncer
#    - Add ?pgbouncer=true to tell Prisma to adapt its query behavior
#    - Set connection_limit based on your compute tier (e.g., 20 for medium)
#
# 2. Use SESSION POOLER (port 5432) for migrations (DIRECT_URL)
#    - prisma migrate and prisma db push need direct/session connection
#    - Transaction pooler does NOT support schema operations
#
# 3. Prisma Connection Pool:
#    - Prisma maintains its own pool (like SQLAlchemy)
#    - Default: num_physical_cpus * 2 + 1
#    - Control via connection_limit query parameter
#
# 4. Connection String Formats:
#    Runtime (DATABASE_URL):
#      postgresql://postgres.[PROJECT_REF]:[PASSWORD]@[POOLER_HOST]:6543/postgres?pgbouncer=true&connection_limit=20&sslmode=require&schema=public
#
#    Migrations (DIRECT_URL):
#      postgresql://postgres.[PROJECT_REF]:[PASSWORD]@[POOLER_HOST]:5432/postgres?sslmode=require&schema=public
#
# WHY DIFFERENT FROM FASTAPI?
# - SQLAlchemy (FastAPI): Works with Session Pooler, no special requirements
# - Prisma (NestJS): Query engine requires Transaction mode, documented in Prisma docs
# - Both are persistent backends, but Prisma has a framework limitation
# -----------------------------------------------------------------------------
