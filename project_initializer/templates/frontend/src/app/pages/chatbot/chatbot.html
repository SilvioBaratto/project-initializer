<div class="flex flex-col h-full">
  <!-- Messages area -->
  <div class="flex-1 overflow-y-auto px-4 py-6 md:px-8" #scrollContainer role="log" aria-label="Chat messages" aria-live="polite">
    @if (messages().length === 0) {
      <div class="flex items-center justify-center h-full">
        <div class="text-center max-w-sm">
          <div class="w-12 h-12 mx-auto mb-4 rounded-2xl bg-accent/10 flex items-center justify-center">
            <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z" />
            </svg>
          </div>
          <h2 class="text-base font-semibold text-text mb-1">Start a conversation</h2>
          <p class="text-sm text-text-secondary">Ask anything to get started.</p>
        </div>
      </div>
    } @else {
      <div class="max-w-3xl mx-auto space-y-4">
        @for (msg of messages(); track msg.id) {
          @if (msg.role === 'user') {
            <div class="flex justify-end">
              <div class="max-w-[80%] rounded-2xl rounded-br-md px-4 py-2.5 bg-accent text-white text-sm leading-relaxed whitespace-pre-wrap">
                {{ msg.content }}
              </div>
            </div>
          } @else if (msg.isError) {
            <div class="flex justify-start">
              <div class="max-w-[80%] rounded-2xl rounded-bl-md px-4 py-2.5 bg-red-50 border border-red-200 text-red-800 text-sm leading-relaxed">
                <div class="flex items-center gap-2">
                  <svg class="w-4 h-4 flex-shrink-0 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
                  </svg>
                  <span>{{ msg.content }}</span>
                </div>
              </div>
            </div>
          } @else {
            <div class="flex justify-start">
              <div class="max-w-[80%] rounded-2xl rounded-bl-md px-4 py-2.5 bg-zinc-100 text-text text-sm leading-relaxed whitespace-pre-wrap">
                {{ msg.content }}
              </div>
            </div>
          }
        }

        @if (isLoading()) {
          <div class="flex justify-start" role="status" aria-label="Assistant is typing">
            <div class="rounded-2xl rounded-bl-md px-4 py-2.5 bg-zinc-100">
              <div class="flex items-center gap-1.5" aria-hidden="true">
                <div class="w-1.5 h-1.5 rounded-full bg-text-secondary/50 animate-bounce motion-reduce:animate-none [animation-delay:0ms]"></div>
                <div class="w-1.5 h-1.5 rounded-full bg-text-secondary/50 animate-bounce motion-reduce:animate-none [animation-delay:150ms]"></div>
                <div class="w-1.5 h-1.5 rounded-full bg-text-secondary/50 animate-bounce motion-reduce:animate-none [animation-delay:300ms]"></div>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Input bar -->
  <div class="border-t border-border bg-surface-raised px-4 py-3 md:px-8">
    <form (ngSubmit)="onSend()" class="max-w-3xl mx-auto flex items-end gap-2">
      <textarea
        aria-label="Chat message"
        class="flex-1 resize-none rounded-xl border border-border bg-surface px-4 py-2.5 text-sm text-text placeholder:text-text-secondary/60 focus:outline-none focus:ring-1 focus:ring-accent/50 focus:border-accent/50 transition-colors"
        rows="1"
        placeholder="Type a message..."
        [value]="userInput()"
        (input)="onInputChange($event)"
        (keydown.enter)="onKeydown($event)"
        [disabled]="isLoading()"
        #inputEl></textarea>
      <button
        type="submit"
        aria-label="Send message"
        [disabled]="isLoading() || !userInput().trim()"
        class="flex-shrink-0 flex items-center justify-center w-11 h-11 rounded-xl bg-accent hover:bg-accent/90 disabled:opacity-40 disabled:cursor-not-allowed text-white transition-colors">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
        </svg>
      </button>
    </form>
  </div>
</div>
